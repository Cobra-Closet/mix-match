CREATE TABLE users (
  user_id SERIAL PRIMARY KEY,
  username varchar(255) NOT NULL UNIQUE,
  password_hash varchar(255) NOT NULL
);

CREATE TABLE tops (
top_id  SERIAL PRIMARY KEY,
user_id int NOT NULL,
color varchar(255),
category varchar(255),
material varchar(255),
style varchar(255),
photo_url varchar(255),
FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE bottoms (
bottom_id SERIAL PRIMARY KEY,
user_id int NOT NULL,
color varchar(255),
category varchar(255),
material varchar(255),
style varchar(255),
photo_url varchar(255),
FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE overalls (
overall_id SERIAL PRIMARY KEY,
user_id int NOT NULL,
color varchar(255),
category varchar(255),
material varchar(255),
style varchar(255),
photo_url varchar(255),
FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE shoes (
shoes_id SERIAL PRIMARY KEY,
user_id int NOT NULL,
color varchar(255),
category varchar(255),
style varchar(255),
photo_url varchar(255),
FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE outfits (
  outfit_id SERIAL PRIMARY KEY,
  user_id int NOT NULL,
  top_id int,
  bottom_id int,
  overall_id int,
  shoes_id int,
  image_url varchar(255),
  FOREIGN KEY (top_id) REFERENCES tops(top_id),
  FOREIGN kEY (bottom_id) REFERENCES bottoms(bottom_id),
  FOREIGN KEY (overall_id) REFERENCES overalls(overall_id),
  FOREIGN KEY (shoes_id) REFERENCES shoes(shoes_id),
  CONSTRAINT if_overall CHECK (
    (overall_id IS NULL AND top_id IS NOT NULL AND bottom_id IS NOT NULL) OR 
    (overall_id IS NOT NULL AND top_id IS NULL AND bottom_id IS NULL)
  )
);

CREATE TABLE sessions (
  session_id SERIAL PRIMARY KEY,
  user_id int NOT NULL,
  session_token varchar(255) UNIQUE NOT NULL,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP, // timestamp when the session was created
  expires_at timestamp with time zone NOT NULL, // timestamp of when the session is expected to expire
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);